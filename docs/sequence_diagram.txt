SEQUENCE DIAGRAM
================================================================================

                College Chatbot - Query Processing Flow


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”
â”‚  Student â”‚  â”‚ Streamlit â”‚  â”‚ FastAPI  â”‚  â”‚   RAG    â”‚  â”‚ ChromaDBâ”‚  â”‚ LLM â”‚
â”‚   User   â”‚  â”‚    UI     â”‚  â”‚ Backend  â”‚  â”‚ Pipeline â”‚  â”‚         â”‚  â”‚     â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”˜
      â”‚             â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚ (1) Type    â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚ Question    â”‚               â”‚             â”‚             â”‚          â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚ (2) POST      â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚ /chat         â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚ {query,       â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚ session_id}   â”‚             â”‚             â”‚          â”‚
      â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚ (3) Process â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚ Query       â”‚             â”‚          â”‚
      â”‚             â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ (4) Rewrite â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ Query       â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ (optional)  â”‚          â”‚
      â”‚             â”‚               â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ (5) Rewritten          â”‚
      â”‚             â”‚               â”‚             â”‚ Query       â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚             â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ (6) Vector  â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ Search      â”‚          â”‚
      â”‚             â”‚               â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ (7) Top 10  â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ Chunks      â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ (8) BM25    â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ Search      â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ (in-memory) â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚â”€â”€â”€â”€â”€â”€â”      â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚      â”‚      â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ (9)  â”‚      â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ Top 10      â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ Chunks      â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚â—€â”€â”€â”€â”€â”€â”˜      â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ (10) Combineâ”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ Results     â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ (Ensemble)  â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚â”€â”€â”€â”€â”€â”€â”      â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚      â”‚      â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚â—€â”€â”€â”€â”€â”€â”˜      â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ (11) Rerank â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ with Cross  â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ Encoder     â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚â”€â”€â”€â”€â”€â”€â”      â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚      â”‚      â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ (12) â”‚      â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ Top 5       â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ Documents   â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚â—€â”€â”€â”€â”€â”€â”˜      â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ (13) Build  â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ Context +   â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ Prompt      â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚â”€â”€â”€â”€â”€â”€â”      â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚      â”‚      â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚â—€â”€â”€â”€â”€â”€â”˜      â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ (14) Generate          â”‚
      â”‚             â”‚               â”‚             â”‚ Answer      â”‚          â”‚
      â”‚             â”‚               â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”¤
      â”‚             â”‚               â”‚             â”‚             â”‚   â”‚ LLM  â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚   â”‚Process
      â”‚             â”‚               â”‚             â”‚             â”‚   â”‚      â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚   â””â”€â”€â”€â”€â”€â”€â–¶â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ (15) Generated         â”‚
      â”‚             â”‚               â”‚             â”‚ Answer +    â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚ Citations   â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚             â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚ (16) Response            â”‚          â”‚
      â”‚             â”‚               â”‚ {answer,    â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚  sources}   â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚ (17) JSON     â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚ Response      â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚ (18) Displayâ”‚               â”‚             â”‚             â”‚          â”‚
      â”‚ Answer +    â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚ Sources     â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚ (19) Click  â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚ Feedback    â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚ (ğŸ‘ or ğŸ‘)  â”‚               â”‚             â”‚             â”‚          â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚ (20) POST     â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚ /feedback     â”‚             â”‚             â”‚          â”‚
      â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚ (21) Save   â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚ to feedback â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚ .jsonl      â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚â”€â”€â”€â”€â”€â”€â”      â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚      â”‚      â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚â—€â”€â”€â”€â”€â”€â”˜      â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚ (22) Success  â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚ (23) Show   â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚ "Thanks!"   â”‚               â”‚             â”‚             â”‚          â”‚
      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚             â”‚             â”‚          â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚          â”‚
â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”  â”Œâ”€â”€â”´â”€â”€â”
â”‚  Student â”‚  â”‚ Streamlit â”‚  â”‚ FastAPI  â”‚  â”‚   RAG    â”‚  â”‚ ChromaDBâ”‚  â”‚ LLM â”‚
â”‚   User   â”‚  â”‚    UI     â”‚  â”‚ Backend  â”‚  â”‚ Pipeline â”‚  â”‚         â”‚  â”‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜


================================================================================

ALTERNATIVE FLOW: DOCUMENT UPLOAD (ADMIN)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin   â”‚  â”‚  Upload   â”‚  â”‚ FastAPI  â”‚  â”‚Document  â”‚  â”‚ ChromaDBâ”‚
â”‚          â”‚  â”‚Interface  â”‚  â”‚ Backend  â”‚  â”‚Pipeline  â”‚  â”‚         â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚             â”‚               â”‚             â”‚             â”‚
      â”‚ (1) Select  â”‚               â”‚             â”‚             â”‚
      â”‚ CSV/PDF     â”‚               â”‚             â”‚             â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚               â”‚             â”‚             â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚
      â”‚             â”‚ (2) POST      â”‚             â”‚             â”‚
      â”‚             â”‚ /upload       â”‚             â”‚             â”‚
      â”‚             â”‚ (multipart)   â”‚             â”‚             â”‚
      â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚             â”‚             â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚
      â”‚             â”‚               â”‚ (3) Save    â”‚             â”‚
      â”‚             â”‚               â”‚ temp file   â”‚             â”‚
      â”‚             â”‚               â”‚â”€â”€â”€â”€â”€â”€â”      â”‚             â”‚
      â”‚             â”‚               â”‚      â”‚      â”‚             â”‚
      â”‚             â”‚               â”‚â—€â”€â”€â”€â”€â”€â”˜      â”‚             â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚
      â”‚             â”‚               â”‚ (4) Process â”‚             â”‚
      â”‚             â”‚               â”‚ Document    â”‚             â”‚
      â”‚             â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚             â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚
      â”‚             â”‚               â”‚             â”‚ (5) Parse   â”‚
      â”‚             â”‚               â”‚             â”‚ & Chunk     â”‚
      â”‚             â”‚               â”‚             â”‚â”€â”€â”€â”€â”€â”€â”      â”‚
      â”‚             â”‚               â”‚             â”‚      â”‚      â”‚
      â”‚             â”‚               â”‚             â”‚â—€â”€â”€â”€â”€â”€â”˜      â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚
      â”‚             â”‚               â”‚             â”‚ (6) Generateâ”‚
      â”‚             â”‚               â”‚             â”‚ Embeddings  â”‚
      â”‚             â”‚               â”‚             â”‚â”€â”€â”€â”€â”€â”€â”      â”‚
      â”‚             â”‚               â”‚             â”‚      â”‚      â”‚
      â”‚             â”‚               â”‚             â”‚â—€â”€â”€â”€â”€â”€â”˜      â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚
      â”‚             â”‚               â”‚             â”‚ (7) Store   â”‚
      â”‚             â”‚               â”‚             â”‚ Vectors     â”‚
      â”‚             â”‚               â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚
      â”‚             â”‚               â”‚             â”‚ (8) Success â”‚
      â”‚             â”‚               â”‚             â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚             â”‚               â”‚             â”‚             â”‚
      â”‚             â”‚               â”‚ (9) Delete  â”‚             â”‚
      â”‚             â”‚               â”‚ temp file   â”‚             â”‚
      â”‚             â”‚               â”‚â”€â”€â”€â”€â”€â”€â”      â”‚             â”‚
      â”‚             â”‚               â”‚      â”‚      â”‚             â”‚
      â”‚             â”‚               â”‚â—€â”€â”€â”€â”€â”€â”˜      â”‚             â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚
      â”‚             â”‚               â”‚ (10) Response            â”‚
      â”‚             â”‚               â”‚ {files,     â”‚             â”‚
      â”‚             â”‚               â”‚  chunks}    â”‚             â”‚
      â”‚             â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚             â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚
      â”‚ (11) Show   â”‚               â”‚             â”‚             â”‚
      â”‚ Success     â”‚               â”‚             â”‚             â”‚
      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚             â”‚             â”‚
      â”‚             â”‚               â”‚             â”‚             â”‚
â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
â”‚  Admin   â”‚  â”‚  Upload   â”‚  â”‚ FastAPI  â”‚  â”‚Document  â”‚  â”‚ ChromaDBâ”‚
â”‚          â”‚  â”‚Interface  â”‚  â”‚ Backend  â”‚  â”‚Pipeline  â”‚  â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================

TIMING BREAKDOWN (Average Query):

Step                                      Time
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(1-2)  User Input â†’ API                   ~0.1s
(3-5)  Query Rewriting (Gemini)           ~1.0s
(6-7)  Vector Search (ChromaDB)           ~0.3s
(8-9)  BM25 Search (local)                ~0.2s
(10)   Ensemble Combine                   ~0.1s
(11-12) Cross-Encoder Rerank              ~0.5s
(13)   Build Context                      ~0.1s
(14-15) LLM Generation (Gemini)           ~2.5s
(16-18) Response Delivery                 ~0.2s
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TOTAL                                     ~5.0s

OPTIMIZATION TARGET: < 2.0s (requires local LLM)

================================================================================
